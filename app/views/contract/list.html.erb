<h1><%= title%></h1>

<%= form_tag( {}, {:class => ""}) do %>
  <div class="form-gorup form-inline">
    <label for="year">対象年月</label>
    <%= select_tag "year", options_for_select(years, params[:year].to_s) %>
    <%= select_tag "month", options_for_select(months, params[:month].to_s) %>
    <%= submit_tag "選択", :name => "select" %>
    <%= submit_tag "クリア", :name => "clear" %>
  </div>
<% end %>

<%= back_to_link "稼働状況表", :action => :works %>

<%= @contract_pages && paginate(@contracts) %>

<% if @summary %>
  <table class="list_table">
    <tr><th>売上</th><th>原価</th><th>粗利</th><th>粗利率</th></tr>
    <tr><td class="right"><%=pay @summary[:upper_payment]%></td><td class="right"><%=pay @summary[:down_payment]%></td><td class="right"><%=pay @summary[:gross_profit]%></td><td class="right"><%= rate @summary[:upper_payment], @summary[:gross_profit] %></td></tr>
  </table>
<% end %>

<table class="list_table">
  <tr>
    <th rowspan=2><%=getShortName('contracts', 'id') %></th>

    <th rowspan=2><%=getShortName('human_resources', 'human_resource_name') %></th>

    <th rowspan=2><%=getShortName('contracts', 'contract_pic_id') %></th>

    <th rowspan=2>契約ST</th>

    <th rowspan=2>契約期間</th>

    <th rowspan=2 title="契約更新単位月数(事前通達月数)">更新</th>

    <th>稼働開始</th>

    <th>上流</th>

    <th title="上流契約ステータス">上流ST</th>

    <th>単価</th>

    <th>支払い</th>

    <th>粗利</th>
  </tr>
  <tr>
    <th>稼働終了</th>

    <th>下流</th>

    <th title="下流契約ステータス">下流ST</th>

    <th>単価</th>

    <th>支払い</th>

    <th>粗利率</th>
  </tr>
<% for contract in @contracts %>
  <tr <%=raw(contract.finished? ? 'style="background-color: lightgray"' : "")%>>
    <td rowspan=2><%=h contract.id %></td>

    <td rowspan=2><%=back_to_link contract.approach.bp_member.human_resource.useful_name, :controller => :approach, :action => :show, :id => contract.approach %></td>

    <td rowspan=2><%=h contract.contract_pic.employee.employee_short_name %></td>

    <td rowspan=2><%=h contract.contract_status_type_name %></td>

    <td rowspan=2><%=h contract.term_term %></td>

    <td rowspan=2><%=h contract.contract_renewal %></td>

    <td><%=_date2 contract.approach.start_date %></td>

    <td><%=h contract.approach.biz_offer.business_partner.business_partner_short_name %></td>

    <td style="background-color: <%=color(contract, contract.upper_contract_status_type)%>"><%=h contract.upper_contract_status_type_name %></td>

    <td class="right"><%=man contract.upper_contract_term.payment_view %></td>

    <td><%=h contract.upper_contract_term.cutoff_and_sight %></td>

    <td class="right"><%=man contract.payment_diff_veiw %></td>
  </tr>
  <tr <%=raw(contract.finished? ? 'style="background-color: lightgray"' : "")%>>
    <td><%=_date2 contract.approach.end_date %></td>

    <td><%=h contract.approach.bp_member.business_partner.business_partner_short_name %></td>

    <td style="background-color: <%=color(contract, contract.down_contract_status_type)%>"><%=h contract.down_contract_status_type_name %></td>

    <td class="right"><%=man contract.down_contract_term.payment_view %></td>

    <td><%=h contract.down_contract_term.cutoff_and_sight %></td>

    <td class="right"><%=h contract.payment_redio %>%</td>
  </tr>
<% end %>
</table>

<%= @contract_pages && paginate(@contracts) %>

<br />

<%= back_to_link (getLongName('table_name','contracts')+'の新規作成'), :action => 'quick_new' %>

<% unless session[:msgids].to_s.split(",").include?("keiyaku1") %>
<div class="alert alert-block">
 <button type="button" class="close" data-dismiss="alert" onclick="fixmessage('<%=url_for(:controller => :users, :action => :fixmessage, :id => 'keiyaku1', :authenticity_token => form_authenticity_token)%>')">&times;</button>
 <h4>注意!</h4>
 <p>
   ※契約を登録する前に、人材所属を前もって登録しておく必要があります。<br/>
   ※未登録の場合、メニューから、人材所属を選択し、新規登録してください。
 </p>
</div>
<% end %>
