<h1><%= getLongName('table_name','delivery_mails')%> 詳細</h1>

<%= render 'show' %>

<!-- 配信メール対象一覧  -->
<h2><%= getLongName('table_name','delivery_mail_targets')%> 一覧</h2>

<div>表示：<select id="filter" onchange="switchDisplayItems();">
<option value="">全て</option>
<option value=".warn">エラーのみ</option>
</select>
<!--<input type="button" id="switch_display" value="エラーのみ" onclick="switchDisplayItems();" title="表示の切り替え">-->
</div>
<table class="show_table" id="delivery_mail_target">
  <tr>
    <th><%= getLongName('business_partners', 'business_partner_name') %></th>
    <th><%= getLongName('bp_pics', 'bp_pic_name') %></th>
    <% if @delivery_mail.mail_status_type == 'unsend' %>
      <th>削除</th>
    <% end %>
  </tr>
  <tr>
    <% @delivery_mail.delivery_mail_targets.each do |delivery_mail_target| %>
      <% err = !delivery_mail_target.delivery_error.empty? %>
      <tr class="<%= err ? 'warn' : 'successful' %>" id="table_header">
        <td><%=
          back_to_link delivery_mail_target.bp_pic.business_partner.business_partner_name,
            :controller => :business_partner,
            :action => :show,
            :id => delivery_mail_target.bp_pic.business_partner_id
        %></td>
        <td><%=
          back_to_link delivery_mail_target.bp_pic.usefulname,
            :controller => :bp_pic,
            :action => :show,
            :id => delivery_mail_target.bp_pic_id
        %></td>
        <% if @delivery_mail.mail_status_type == 'unsend' %>
          <td><%=
            back_to_link "削除",
              {:controller => :delivery_mail_targets,
                :action => :destroy,
                :id => delivery_mail_target.id,
                :authenticity_token => form_authenticity_token},
                :method => :delete, :confirm => "このレコードを削除します。よろしいですか？"
          %></td>
        <% end %>
      </tr>
    <% end %>
  </tr>
</table>

<% if @delivery_mail.unsend? %>
  <%= back_to_link '編集', {:action => :edit, :id => @delivery_mail.id} %> |
<% end %>
<%= link_or_back '戻る', {:action => :index, :id => @delivery_mail.bp_pic_group_id} %>

<script><!--
var BUTTON_TEXT=['エラーのみ', 'すべて']
function switchDisplayItems(){
  $('tr.successful').toggle();
}

var filter_target = "table#delivery_mail_target tr:gt(0)";
$('#filter').change(function(){
  var filter = $('#filter option:selected')[0].value;
  if(filter != "") { $(filter_target).css('display', 'none'); }
  $(filter_target + filter).css('display', 'table-row');
});

//--></script>
